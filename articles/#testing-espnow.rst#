====================================================
Testing ESPNOW
====================================================
:date: 2017-10-28
:save_as: testing-espnow.html
:slug: testing-espnow
:tags: esp32

ESP32の `etherボード <{filename}/esp32-phy.rst>`_ とESP32の `センサボード <{filename}/images/hb32.jpg>`_  でESPNOWでの通信を試して挙動を調べました.  全体の構成は

.. image:: {filename}/images/ether-now-bridge.png
   :height: 400
   :width: 640
   :alt: esp32 ether-espnow brigde

でPCの上ではarducopterとテスト用のUDPサーバの両方を動かして試してみました. 結果現在のESP32のespnow通信は次のような挙動をするようです.

    * 近接で通信した場合latencyは2ms位で安定している

    * 送信と送信の間に間隔が必要. 送信のみ繰り返す場合2msほど必要に見える

    * 受信を行うとこの間隔が影響される

実際のテストではセンサボードからespnowでパケットを投げ送信終了のコールバックが終わるまで待つようにし送信のみの場合~500Hzぐらいのレートで~70byteぐらいのデータが送信できていました. 100Hzのレートで~30byteほどを受信するようにすると送信側のレートは10%ぐらい低下しました. 送受の切り替え時にデッドタイムがあるような挙動ですが、espnowのライブラリはソースがないので確かなことはわかりません.

今の所espnowを使ってリモートセンサ/アクチュエータ方式でコプターを飛ばすのは厳しい感じです. espnowをWi-Fiに取り替えてこのハード構成で実験中です. ESP32+PHYボードを専用のAPにする感じでしょうか. Wi-Fiのtui



